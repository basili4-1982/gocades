// string->void
void CCadesAttribute_put_oid(CCadesAttribute *m, char* value)
{
    CPPCadesCPAttributeObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return;
    }

    obj = static_cast<CPPCadesCPAttributeObject *>(m->obj);
    CAtlStringA sValue(value);
    HRESULT hr = obj->put_OID(sValue);
    ErrMsgFromHResult(hr, m->err);
    return;
}

// void->object
CCadesOID* CCadesAttribute_get_oid(CCadesAttribute *m)
{
    boost::shared_ptr<CryptoPro::PKI::CAdES::CPPCadesCPOIDObject> pObj;
    HRESULT hr = reinterpret_cast<CPPCadesCPAttributeObject *>(m->obj)->get_OID(pObj);
    ErrMsgFromHResult(hr, m->err);

    CCadesOID *ret = CCadesOID_create();
    ret->obj = (void*)pObj.get();

    return ret;
}

// void->blob
char* CCadesAttribute_get_value(CCadesAttribute *m)
{
    CPPCadesCPAttributeObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPAttributeObject *>(m->obj);
    CryptoPro::CBlob blob;
    HRESULT hr = obj->get_Value(blob);
    CAtlString sValue((char*)blob.pbData(), blob.cbData());
    ErrMsgFromHResult(hr, m->err);
    return (char*)sValue.GetString();
}

// blob->void
void CCadesAttribute_put_value(CCadesAttribute *m, char* value)
{
    CPPCadesCPAttributeObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return;
    }

    obj = static_cast<CPPCadesCPAttributeObject *>(m->obj);
    CAtlStringA sValue(value);
    CryptoPro::CBlob blob((const unsigned char *)sValue.GetBuffer(), sValue.GetLength());
    HRESULT hr = obj->put_Value(blob);
    ErrMsgFromHResult(hr, m->err);
    return;
}

// int->void
void CCadesAttribute_put_name(CCadesAttribute *m, int value)
{
    CPPCadesCPAttributeObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return;
    }

    obj = static_cast<CPPCadesCPAttributeObject *>(m->obj);
    HRESULT hr = obj->put_Name((CADESCOM_ATTRIBUTE)value);
    ErrMsgFromHResult(hr, m->err);
    return;
}

// void->int
int CCadesAttribute_get_build_version(CCadesAttribute *m)
{
    CPPCadesCPAttributeObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPAttributeObject *>(m->obj);
    CADESCOM_ATTRIBUTE val;
    HRESULT hr = obj->get_Name(&val);
    DWORD r = (DWORD)val;
    ErrMsgFromHResult(hr, m->err);
    return r;
}


// govoid->goobject
func (obj *GoCadesAttribute) GetOID() (*GoCadesOID, error) {
	ret := &GoCadesOID{C.CCadesAttribute_get_oid(obj.cobjptr)}

	runtime.SetFinalizer(ret, func(obj *GoCadesOID) {
		C.CCadesOID_destroy(obj.cobjptr)
	})
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return nil, errors.New(err)
	}
	return ret, nil
}

// gostring->govoid
func (obj *GoCadesAbout) PutOID(value string) error {
	cstr := C.CString(value)
	defer C.free(unsafe.Pointer(cstr))
	C.CCadesAttribute_put_oid(obj.cobjptr, cstr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return errors.New(err)
	}
	return nil
}

// govoid->gostring
func (obj *GoCadesAttribute) GetValue() (string, error) {
	var ret string
	val := C.CCadesAttribute_get_value(obj.cobjptr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return "", errors.New(err)
	}
	ret = C.GoString(val)
	return ret, nil
}

// goint->govoid
func (obj *GoCadesAttribute) PutName(value int) error {
	C.CCadesAttribute_put_name(obj.cobjptr, C.int(value))
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return errors.New(err)
	}
	return nil
}

// gostring->govoid
func (obj *GoCadesAbout) PutOID(value string) error {
	cstr := C.CString(value)
	defer C.free(unsafe.Pointer(cstr))
	C.CCadesAttribute_put_oid(obj.cobjptr, cstr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return errors.New(err)
	}
	return nil
}

// int->void
void CCadesEKU_put_name(CCadesEKU *m, int value)
{
    CPPCadesEKUObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return;
    }

    obj = static_cast<CPPCadesEKUObject *>(m->obj);
    HRESULT hr = obj->put_Name((CAPICOM_EKU)value);
    ErrMsgFromHResult(hr, m->err);
    return;
}

// object->void
void CCadesAttributes_add(CCadesAttributes *m, CCadesAttribute *obj)
{
    boost::shared_ptr<CryptoPro::PKI::CAdES::CPPCadesCPAttributeObject> pObj((CPPCadesCPAttributeObject*)obj->obj);
    HRESULT hr = reinterpret_cast<CPPCadesCPAttributesObject *>(m->obj)->Add(pObj);
    ErrMsgFromHResult(hr, m->err);
    return;
}

// void->void
void CCadesAttributes_add(CCadesAttributes *m)
{
    HRESULT hr = reinterpret_cast<CPPCadesCPAttributesObject *>(m->obj)->Clear();
    ErrMsgFromHResult(hr, m->err);
    return;
}

// govoid->goint
func (obj *GoCadesAttributes) GetCount() (int, error) {
	var ret int
	val := C.CCadesAttributes_get_count(obj.cobjptr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return ret, errors.New(err)
	}
	ret = int(val)
	return ret, nil
}

// goint->goobject
func (obj *GoCadesAttributes) GetItem(value int) (*GoCadesAttribute, error) {
	ret := &GoCadesAttribute{C.CCadesAttributes_get_item(obj.cobjptr, C.int(value))}

	runtime.SetFinalizer(ret, func(obj *GoCadesAttribute) {
		C.CCadesAttribute_destroy(obj.cobjptr)
	})
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return nil, errors.New(err)
	}
	return ret, nil
}

// goobject->govoid
func (obj *GoCadesAttributes) Add(value GoCadesAttribute) error {
	C.CCadesAttributes_add(obj.cobjptr, value.cobjptr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return errors.New(err)
	}
	return nil
}

// govoid->govoid
func (obj *GoCadesAttributes) Clear() error {
	C.CCadesAttributes_clear(obj.cobjptr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return errors.New(err)
	}
	return nil
}

// int->string
char* CCadesLicense_get_first_install_date(CCadesLicense *m, int value)
{
    CPPCadesCPLicenseObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPLicenseObject *>(m->obj);
    CAtlString sValue;
    HRESULT hr = obj->FirstInstallDate(value, sValue);
    ErrMsgFromHResult(hr, m->err);
    return (char*)sValue.GetString();
}

// goint->gostring
func (obj *GoCadesAbout) GetCSPName(ProvType int) (string, error) {
	var ret string
	val := C.CCadesAbout_get_csp_name(obj.cobjptr, C.int(ProvType))
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return "", errors.New(err)
	}
	ret = C.GoString(val)
	return ret, nil
}

// int->blob
char* CCadesCRL_export(CCadesCRL *m, int value)
{
    CPPCadesCPCRLObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPCRLObject *>(m->obj);
    CryptoPro::CBlob blob;
    HRESULT hr = obj->Export((CAPICOM_ENCODING_TYPE)value, blob);
    CAtlString sValue(blob.pbData());
    ErrMsgFromHResult(hr, m->err);
    return (char*)sValue.GetString();
}

// void->string
char* CCadesCRL_get_issuer_name(CCadesCRL *m)
{
    CPPCadesCPCRLObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPCRLObject *>(m->obj);
    CAtlString sValue;
    HRESULT hr = obj->get_IssuerName(sValue);
    ErrMsgFromHResult(hr, m->err);
    return (char*)sValue.GetString();
}

// void->time
char* CCadesCRL_get_this_update(CCadesCRL *m)
{
    CPPCadesCPCRLObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPCRLObject *>(m->obj);
    CryptoPro::CDateTime d;
    HRESULT hr = obj->get_ThisUpdate(d);
    CAtlString sValue = d.tostring().c_str();
    ErrMsgFromHResult(hr, m->err);
    return (char*)sValue.GetString();
}

// void->bool
bool CCadesBasicConstraints_get_is_present(CCadesBasicConstraints *m)
{
    CPPCadesCPBasicConstraintsObject *obj;

    if (m == NULL){
        ErrMsgFromHResult(E_UNEXPECTED, m->err);
        return 0;
    }

    obj = static_cast<CPPCadesCPBasicConstraintsObject *>(m->obj);
    BOOL res;
    HRESULT hr = obj->get_IsPresent(&res);
    ErrMsgFromHResult(hr, m->err);
    return res;
}

// govoid->gobool
func (obj *GoCadesBasicConstraints) GetIsPresent() (bool, error) {
	var ret bool
	val := C.CCadesBasicConstraints_get_is_present(obj.cobjptr)
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return ret, errors.New(err)
	}
	ret = bool(val)
	return ret, nil
}

// gobool->govoid
func (obj *GoCadesBasicConstraints) SetIsPresent(value bool) error {
	C.CCadesBasicConstraints_put_is_present(obj.cobjptr, C.bool(value))
	err := C.GoString(obj.cobjptr.err)
	if err != "" {
		return errors.New(err)
	}
	return nil
}
